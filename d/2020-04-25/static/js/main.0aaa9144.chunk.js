(this["webpackJsonpremote-faces-web"]=this["webpackJsonpremote-faces-web"]||[]).push([[0],[,,,,,,,,,,,,,,,function(e,t,n){e.exports=n(28)},,,,,function(e,t,n){},function(e,t,n){},,function(e,t,n){},function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=24},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(9),o=n.n(c),i=(n(20),n(10)),u=n(11),s=n(13),l=n(14),d=n(2),f=function(){var e=Object(r.useState)(30),t=Object(d.a)(e,2),n=t[0],c=t[1];return Object(r.useEffect)((function(){n>0?setTimeout((function(){c(n-1)}),1e3):window.location.reload()})),a.a.createElement("div",null,a.a.createElement("h1",null,"Unrecoverable error occurred."),a.a.createElement("p",null,"Will auto reload in ",n," sec."))},m=(n(21),n(1)),v=n.n(m),p=n(3),b=function(){var e=window.crypto.getRandomValues(new Uint8Array(32));return Array.from(e).map((function(e){return e.toString(16).padStart(2,"0")})).join("")},h=function(){return 1e3+window.crypto.getRandomValues(new Uint16Array(1))[0]%9e3},g=function(e){try{var t=new URL(e).hash.slice(1);return new URLSearchParams(t).get("roomId")}catch(n){return null}},y=(n(23),n(4)),E=n(12),k=n.n(E),I=function(e,t){return"".concat(e,"_").concat(t)},O=function(e){return Number(e.split("_")[1])},w=function(e){return O(e.peer)},j=function(e){var t=O(e);return 10<=t&&t<=14},C=function(e,t,n,r,a,c){var o=!1,i=null,u=null,s=function(){var e=new Map;return{addConn:function(t){var n=e.get(t.peer);n&&n.conn.close(),e.set(t.peer,{conn:t})},markConnected:function(t){var n=e.get(t.peer);n&&(n.connected=!0)},isConnected:function(t){var n=e.get(t);return n&&n.connected||!1},setUserId:function(t,n){var r=e.get(t.peer);r&&(r.userId=n)},getUserId:function(t){var n=e.get(t.peer);return n&&n.userId},setLiveMode:function(t,n){var r=e.get(t.peer);r&&(r.liveMode=n)},getLiveMode:function(t){var n=e.get(t.peer);return n&&n.liveMode||!1},hasConn:function(t){return e.has(t)},delConn:function(t){var n=e.get(t.peer);n&&n.conn===t&&e.delete(t.peer)},getConnectedPeerIds:function(){return Array.from(e.keys()).filter((function(t){var n;return null===(n=e.get(t))||void 0===n?void 0:n.connected}))},getLivePeerIds:function(){return Array.from(e.keys()).filter((function(t){var n=e.get(t);return n&&n.connected&&n.liveMode}))},forEachConnectedConns:function(t){Array.from(e.values()).forEach((function(e){e.connected&&t(e.conn)}))},forEachLiveConns:function(t){Array.from(e.values()).forEach((function(e){e.connected&&e.liveMode&&t(e.conn)}))},clearAll:function(){e.size&&console.log("connectionMap garbage:",e),e.clear()}}}(),l=!1,d=function(){if(!o){var e=s.getConnectedPeerIds().map(O);r({type:"CONNECTED_PEERS",peerIndexList:e})}},f=function(e){if(!o&&i&&i.id!==e&&!s.hasConn(e)){console.log("connectPeer",e);var t=i.connect(e,{serialization:"json"});E(t)}},m=function(e,n){if(!o){n&&(u=e);var r=s.getConnectedPeerIds(),a=s.getLivePeerIds();s.forEachConnectedConns((function(n){try{n.send({userId:t,data:e,peers:r,liveMode:l,livePeers:a})}catch(c){console.error("broadcastData",c)}}))}},b=function(e,t){e.send({SDP:t})},g=function(){var e=Object(p.a)(v.a.mark((function e(t,n){var r,a,c;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&"object"===typeof n){e.next=2;break}return e.abrupt("return");case 2:if("object"!==typeof n.offer){e.next=20;break}return r=n.offer,e.prev=4,e.next=7,t.peerConnection.setRemoteDescription(r);case 7:return e.next=9,t.peerConnection.createAnswer();case 9:return a=e.sent,e.next=12,t.peerConnection.setLocalDescription(a);case 12:b(t,{answer:a}),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),console.log("handleSDP offer failed",e.t0);case 18:e.next=33;break;case 20:if("object"!==typeof n.answer){e.next=32;break}return c=n.answer,e.prev=22,e.next=25,t.peerConnection.setRemoteDescription(c);case 25:e.next=30;break;case 27:e.prev=27,e.t1=e.catch(22),console.log("handleSDP answer failed",e.t1);case 30:e.next=33;break;case 32:console.warn("unkonwn SDP",n);case 33:case"end":return e.stop()}}),e,null,[[4,15],[22,27]])})));return function(t,n){return e.apply(this,arguments)}}(),y=function(t,n){if(!o&&(n||"object"===typeof n)){g(t,n.SDP),function(e,t){"string"===typeof t&&s.setUserId(e,t)}(t,n.userId),function(e,t){"boolean"===typeof t&&(s.setLiveMode(e,t),t?x(e):M(e))}(t,n.liveMode),Array.isArray(n.peers)&&n.peers.forEach((function(t){(function(e,t){return"string"===typeof t&&t.startsWith("".concat(e,"_"))})(e,t)&&f(t)}));var r=s.getUserId(t);if(r){var c={userId:r,peerIndex:w(t),liveMode:s.getLiveMode(t)};try{a(n.data,c)}catch(i){console.error("receiveData",i)}}}},E=function(e){s.isConnected(e.peer)?e.close():(s.addConn(e),e.on("open",(function(){s.markConnected(e),d(),u&&e.send({userId:t,data:u,peers:s.getConnectedPeerIds(),liveMode:l,livePeers:s.getLivePeerIds()})})),e.on("data",(function(t){return y(e,t)})),e.peerConnection.ontrack=function(t){var n=t.track,r=t.streams[0],a=s.getUserId(e);if(a){n.addEventListener("ended",(function(){r.removeTrack(n);var e=new Event("removetrack");e.track=n,r.dispatchEvent(e)}));var o={userId:a,peerIndex:O(e.peer)};c(r,o)}},e.on("close",(function(){if(s.delConn(e),console.log("dataConnection closed",e),r({type:"CONNECTION_CLOSED",peerIndex:w(e)}),d(),0===s.getConnectedPeerIds().length)S(!0);else if(j(e.peer)&&i&&!i.disconnected&&!j(i.id)){var t=30+Math.floor(60*Math.random());console.log("Disconnected seed peer: ".concat(O(e.peer),", reinit in ").concat(t,"sec...")),setTimeout(S,1e3*t)}})))},C=function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;if(!o&&!i){s.clearAll();var a=10<=n&&n<=14,c=a?n:h();r({type:"INITIALIZING_PEER",peerIndex:c});var l=I(e,c);console.log("initMyPeer start",n,l);var d=new k.a(l,{debug:2});i=d,d.on("open",(function(){i=d,r({type:"CONNECTING_SEED_PEERS"});for(var t=10;t<=14;t+=1){var n=I(e,t);f(n)}})),d.on("error",(function(e){"unavailable-id"===e.type?(i=null,u=null,d.destroy(),t(n+1)):"peer-unavailable"===e.type||("network"===e.type?(console.log("initMyPeer network error",n,e),d.destroy()):(console.error("initMyPeer",n,e.type,e),r({type:"UNKNOWN_ERROR"})))})),d.on("connection",(function(e){i===d?(console.log("new connection received",e),r({type:"NEW_CONNECTION",peerIndex:w(e)}),E(e)):e.close()})),d.on("disconnected",(function(){console.log("initMyPeer disconnected",n),setTimeout((function(){i!==d||d.destroyed||(console.log("initMyPeer reconnecting",n),r({type:"RECONNECTING"}),d.reconnect())}),5e3)})),d.on("close",(function(){i===d?(console.log("initMyPeer closed, re-initializing",n),i=null,u=null,setTimeout(t,1e4)):console.log("initMyPeer closed, ignoring",n)}))}};C();var S=function(t){if(i&&!i.disconnected){if(!t){if(j(i.id))return;for(var n=!0,r=10;r<=14;r+=1){var a=I(e,r);if(!s.isConnected(a)){n=!1;break}}if(n)return void d()}var c=i;i=null,u=null,c.destroy(),C()}};n.addEventListener("addtrack",(function(e){s.forEachLiveConns(function(){var t=Object(p.a)(v.a.mark((function t(r){var a;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r.peerConnection.addTrack(e.track,n),t.next=4,r.peerConnection.createOffer();case 4:return a=t.sent,t.next=7,r.peerConnection.setLocalDescription(a);case 7:b(r,{offer:a}),t.next=16;break;case 10:if(t.prev=10,t.t0=t.catch(0),"InvalidAccessError"!==t.t0.name){t.next=15;break}t.next=16;break;case 15:throw t.t0;case 16:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(e){return t.apply(this,arguments)}}())})),n.addEventListener("removetrack",(function(e){s.forEachLiveConns(function(){var t=Object(p.a)(v.a.mark((function t(n){var r,a;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=n.peerConnection.getSenders(),(a=r.find((function(t){return t.track===e.track})))&&n.peerConnection.removeTrack(a);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}));var x=function(){var e=Object(p.a)(v.a.mark((function e(t){var r,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!1,n.getTracks().forEach((function(e){try{t.peerConnection.addTrack(e,n),r=!0}catch(a){if("InvalidAccessError"!==a.name)throw a}})),r){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,t.peerConnection.createOffer();case 6:return a=e.sent,e.next=9,t.peerConnection.setLocalDescription(a);case 9:b(t,{offer:a});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=Object(p.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.peerConnection.getSenders().forEach((function(e){e.track&&t.peerConnection.removeTrack(e)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{broadcastData:m,enableLiveMode:function(){l?console.warn("liveMode already enabled"):(l=!0,m(u))},disableLiveMode:function(){l?(l=!1,m(u)):console.warn("liveMode already disabled")},dispose:function(){o=!0,i&&i.destroy()}}},S=new Map,x=function(e,t,n,r,a){var c="".concat(e,"_").concat(t),o=S.get(c);if(!o){var i=new Set,u=new Set,s=new Set,l=new MediaStream,d=C(e,t,l,(function(e){i.forEach((function(t){t(e)}))}),(function(e,t){u.forEach((function(n){n(e,t)}))}),(function(e,t){s.forEach((function(n){n(e,t)}))}));o={room:d,networkStatusListeners:i,dataListeners:u,streamListeners:s,myStream:l,count:0},S.set(c,o)}n&&o.networkStatusListeners.add(n),r&&o.dataListeners.add(r),a&&(o.streamListeners.add(a),1===o.streamListeners.size&&o.room.enableLiveMode()),o.count+=1;return{broadcastData:o.room.broadcastData,myStream:o.myStream,unregister:function(){n&&o.networkStatusListeners.delete(n),r&&o.dataListeners.delete(r),a&&(o.streamListeners.delete(a),0===o.streamListeners.size&&o.room.disableLiveMode()),o.count-=1,o.count<=0&&(o.room.dispose(),S.delete(c))}}},M=function(e,t){var n=Object(r.useRef)(),a=Object(r.useCallback)((function(){n.current&&n.current.apply(n,arguments)}),[]);return Object(r.useEffect)((function(){var r=x(e,t),a=r.broadcastData,c=r.unregister;return n.current=a,c}),[e,t]),a},A=function(e,t,n){var a=Object(r.useState)(),c=Object(d.a)(a,2),o=c[0],i=c[1];return Object(r.useEffect)((function(){return x(e,t,void 0,(function(e,t){return n(e)&&i({data:e,info:t}),!1})).unregister}),[e,t,n]),o},N=function(){var e=Object(p.a)(v.a.mark((function e(){var t,n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:return t=e.sent,n=t.filter((function(e){return"videoinput"===e.kind})).map((function(e){return{label:e.label,deviceId:e.deviceId}})),e.abrupt("return",n);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=Object(p.a)(v.a.mark((function e(){var t,n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:return t=e.sent,n=t.filter((function(e){return"audioinput"===e.kind})).map((function(e){return{label:e.label,deviceId:e.deviceId}})),e.abrupt("return",n);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),T=(n(25),n(6)),D=function(e){return new Promise((function(t){return setTimeout(t,e)}))},R=function(){var e=Object(p.a)(v.a.mark((function e(t,n){var r,a,c,o,i,u,s,l,d,f,m;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"===typeof ImageCapture){e.next=21;break}return r=new ImageCapture(n),e.next=4,D(2e3);case 4:return e.prev=4,e.next=7,r.takePhoto();case 7:return c=e.sent,e.next=10,createImageBitmap(c);case 10:a=e.sent,e.next=18;break;case 13:return e.prev=13,e.t0=e.catch(4),e.next=17,r.grabFrame();case 17:a=e.sent;case 18:return o=a.width,i=a.height,e.abrupt("return",{srcImg:a,srcW:o,srcH:i});case 21:return(u=document.getElementById("internal-video")).style.display="block",s=u.srcObject,l=function(){u.srcObject=s},u.srcObject=t,e.next=28,D(2e3);case 28:return d=u,f=u.videoWidth,m=u.videoHeight,e.abrupt("return",{srcImg:d,srcW:f,srcH:m,revert:l});case 32:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(t,n){return e.apply(this,arguments)}}(),P=function(){var e=Object(p.a)(v.a.mark((function e(t){var n,r,a,c,o,i,u,s,l,d,f,m,p,b,h,g,y;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?{video:{deviceId:t}}:{video:!0},e.next=3,navigator.mediaDevices.getUserMedia(n);case 3:return r=e.sent,a=r.getVideoTracks()[0],c=document.getElementById("internal-canvas"),o=c.getContext("2d"),i=72,u=72,c.width=i,c.height=u,e.next=13,R(r,a);case 13:return s=e.sent,l=s.srcImg,d=s.srcW,f=s.srcH,m=s.revert,p=Math.max(i/d,u/f),b=Math.min(d,i/p),h=Math.min(f,u/p),g=(d-b)/2,y=(f-h)/2,o.drawImage(l,g,y,b,h,0,0,i,u),m&&m(),a.stop(),e.abrupt("return",c.toDataURL("image/png"));case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(e){return e&&"object"===typeof e&&"string"===typeof e.image&&function(e){return e&&"object"===typeof e&&"string"===typeof e.nickname&&"string"===typeof e.message}(e.info)},V=function(){var e=Object(p.a)(v.a.mark((function e(t){var n,r,a,c,o,i,u,s,l,d,f,m,p,b,h,g;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?{video:{deviceId:t}}:{video:!0},e.next=3,navigator.mediaDevices.getUserMedia(n);case 3:return r=e.sent,a=r.getVideoTracks()[0],(c=document.getElementById("internal-video")).style.display="block",c.srcObject=r,e.next=10,D(1e3);case 10:return o=c.videoWidth,i=c.videoHeight,u=document.getElementById("internal-canvas"),s=u.getContext("2d"),72,72,u.width=72,u.height=72,l=Math.max(72/o,72/i),d=Math.min(o,72/l),f=Math.min(i,72/l),m=(o-d)/2,p=(i-f)/2,b=setInterval((function(){s.drawImage(c,m,p,d,f,0,0,72,72)}),1e3/30),h=u.captureStream(),g=function(){c.style.display="none",clearInterval(b),a.stop(),h.getVideoTracks()[0].stop()},e.abrupt("return",{stream:h,dispose:g});case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=Object(p.a)(v.a.mark((function e(t){var n,r,a,c;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?{audio:{deviceId:t}}:{audio:!0},e.next=3,navigator.mediaDevices.getUserMedia(n);case 3:return r=e.sent,a=r.getAudioTracks()[0],e.next=7,a.applyConstraints({echoCancellation:!0,echoCancellationType:{ideal:"system"},noiseSuppression:{ideal:!0}});case 7:return c=function(){a.stop()},e.abrupt("return",{stream:r,dispose:c});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(e,t,n,a,c,o){var i=function(e,t,n){var a=Object(r.useState)(null),c=Object(d.a)(a,2),o=c[0],i=c[1],u=Object(r.useState)([]),s=Object(d.a)(u,2),l=s[0],f=s[1];return Object(r.useEffect)((function(){if(n){var r=x(e,t,void 0,void 0,(function(e,t){f((function(n){return[].concat(Object(y.a)(n.filter((function(e){return e.info.userId!==t.userId}))),Object(y.a)(e?[{stream:e,info:t}]:[]))}))})),a=r.myStream,c=r.unregister;return i(a||null),c}i(null),f([])}),[e,t,n]),{myStream:o,streamList:l}}(e,t,n||a),u=i.myStream,s=i.streamList;Object(r.useEffect)((function(){var e=null;return n&&u&&Object(p.a)(v.a.mark((function t(){var n,r,a,o,i;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,V(c);case 2:n=t.sent,r=n.stream,a=n.dispose,o=r.getVideoTracks()[0],u.addTrack(o),(i=new Event("addtrack")).track=o,u.dispatchEvent(i),e=function(){u.removeTrack(o),a();var e=new Event("removetrack");e.track=o,u.dispatchEvent(e)};case 11:case"end":return t.stop()}}),t)})))(),function(){e&&e()}}),[e,n,c,u]),Object(r.useEffect)((function(){var e=null;return a&&u&&Object(p.a)(v.a.mark((function t(){var n,r,a,c,i;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,F(o);case 2:n=t.sent,r=n.stream,a=n.dispose,c=r.getAudioTracks()[0],u.addTrack(c),(i=new Event("addtrack")).track=c,u.dispatchEvent(i),e=function(){u.removeTrack(c),a();var e=new Event("removetrack");e.track=c,u.dispatchEvent(e)};case 11:case"end":return t.stop()}}),t)})))(),function(){e&&e()}}),[e,a,o,u]);var l=Object(r.useMemo)((function(){var e={};return s.forEach((function(t){e[t.info.userId]=t.stream})),e}),[s]);return{myStream:u,streamMap:l}},W=a.a.memo((function(e){var t=e.image,n=e.nickname,c=e.statusMesg,o=e.obsoleted,i=e.liveMode,u=e.stream,s=e.unmuted,l=Object(r.useState)(!1),f=Object(d.a)(l,2),m=f[0],v=f[1],p=Object(r.useState)(!1),b=Object(d.a)(p,2),h=b[0],g=b[1],y=Object(r.useRef)(null);return Object(r.useEffect)((function(){u&&y.current&&(y.current.srcObject=u);var e=function(){v(!!u&&u.getVideoTracks().length>0),g(!!u&&u.getAudioTracks().length>0)};return u&&(u.addEventListener("addtrack",e),u.addEventListener("removetrack",e)),e(),function(){u&&(u.removeEventListener("addtrack",e),u.removeEventListener("removetrack",e))}}),[u]),a.a.createElement("div",{className:"FaceImages-card",style:{opacity:o?.2:1}},u?a.a.createElement("video",{className:"FaceImages-photo",ref:y,autoPlay:!0,muted:!s}):a.a.createElement("img",{src:t||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQI12NgYAAAAAMAASDVlMcAAAAASUVORK5CYII=",className:"FaceImages-photo",alt:"myself"}),a.a.createElement("div",{className:"FaceImages-name"},n),a.a.createElement("div",{className:"FaceImages-mesg"},c),i&&m&&h&&a.a.createElement("div",{className:"FaceImages-live-indicator",title:"Video/Audio On"},"\u25c8"),i&&m&&!h&&a.a.createElement("div",{className:"FaceImages-live-indicator",title:"Video On"},"\u25c9"),i&&!m&&!h&&a.a.createElement("div",{className:"FaceImages-live-indicator",title:"Video On"},"\u25ce"))})),q=a.a.memo((function(e){var t=e.roomId,n=e.userId,c=e.nickname,o=e.statusMesg,i=e.liveType,u=e.videoDeviceId,s=e.audioDeviceId,l=function(e,t,n,a,c){var o=Object(r.useState)(),i=Object(d.a)(o,2),u=i[0],s=i[1],l=Object(r.useState)([]),f=Object(d.a)(l,2),m=f[0],b=f[1],h=Object(r.useState)(),g=Object(d.a)(h,2),E=g[0],k=g[1],I=Object(r.useRef)({nickname:n,message:a});if(I.current={nickname:n,message:a},E)throw E;var O=M(e,t),w=A(e,t,U),j=Object(r.useMemo)((function(){return w&&Object(T.a)({},w.data,{userId:w.info.userId,received:Date.now(),obsoleted:!1,liveMode:w.info.liveMode})}),[w]);if(j){var C=m.find((function(e){return e.userId===j.userId}));C?C.received!==j.received&&b(m.map((function(e){return e.userId===j.userId?j:e}))):b([].concat(Object(y.a)(m),[j]))}return Object(r.useEffect)((function(){var e=function(){var e=Date.now()-12e4,t=Date.now()-6e5;b((function(n){var r=!1,a=n.map((function(n){return n.received<e&&!n.obsoleted?(r=!0,Object(T.a)({},n,{obsoleted:!0})):n.received<t&&n.obsoleted?(r=!0,null):n})).filter((function(e){return e}));return r?a:n}))},n=function(){var n=Object(p.a)(v.a.mark((function n(){var r,a;return v.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,e(),n.next=4,P(c);case 4:r=n.sent,s(r),a={userId:t,image:r,info:I.current},O(a,!0),n.next=14;break;case 10:n.prev=10,n.t0=n.catch(0),console.error(n.t0),k(n.t0);case 14:case"end":return n.stop()}}),n,null,[[0,10]])})));return function(){return n.apply(this,arguments)}}();n();var r=setInterval(n,12e4);return function(){clearTimeout(r)}}),[e,t,c,O]),{myImage:u,roomImages:m}}(t,n,c,o,u),f=l.myImage,m=l.roomImages,b=_(t,n,"video"===i||"video+audio"===i,"video+audio"===i,u,s),h=b.myStream,g=b.streamMap;return a.a.createElement("div",{className:"FaceImage-container"},a.a.createElement(W,{image:f,nickname:c,statusMesg:o,liveMode:"off"!==i,stream:h||void 0}),m.map((function(e){return a.a.createElement(W,{key:e.userId,image:e.image,nickname:e.info.nickname,statusMesg:e.info.message,obsoleted:e.obsoleted,liveMode:e.liveMode,stream:g[e.userId],unmuted:"video+audio"===i})})))})),B=(n(26),function(e){return e&&"object"===typeof e&&"string"===typeof e.userId&&"string"===typeof e.nickname&&"number"===typeof e.chatSeq&&"string"===typeof e.chatText&&("undefined"===typeof e.chatInReplyTo||"string"===typeof e.chatInReplyTo.userId||"number"===typeof e.chatInReplyTo.chatSeq)}),H=function(e,t){var n=t[1]-e[1];return 0===n?e[0].length-t[0].length:n},z=["\ud83d\udc4d","\u2764\ufe0f","\ud83d\ude01","\ud83d\ude0e","\ud83e\udd23"],G=function(e){var t=e.text,n=e.onClick;return a.a.createElement("button",{type:"button",onClick:function(){return n(t)}},a.a.createElement("span",{"aria-label":"Reaction"},t))},K=a.a.memo((function(e){var t=e.chatList,n=e.replyChat;return a.a.createElement("ul",{className:"MomentaryChat-list"},t.map((function(e){var t=function(t){return n(t,e.replyTo)};return a.a.createElement("li",{key:e.key,className:"MomentaryChat-listPart"},a.a.createElement("div",{className:"MomentaryChat-listPart-header"},a.a.createElement("div",{className:"MomentaryChat-iconButton-container"},a.a.createElement("div",{className:"MomentaryChat-iconButton"},z.map((function(e){return a.a.createElement(G,{key:e,text:e,onClick:t})})))),a.a.createElement("div",{className:"MomentaryChat-nickname"},e.nickname||"No Name")),a.a.createElement("div",null,e.text),e.replies.map((function(e){var t=Object(d.a)(e,2),n=t[0],r=t[1];return a.a.createElement("div",{className:"Momentary-icon"},n," ",r)})))})))})),Y=a.a.memo((function(e){var t=function(e,t,n){var a=Object(r.useRef)(1),c=Object(r.useRef)(new Map),o=Object(r.useState)([]),i=Object(d.a)(o,2),u=i[0],s=i[1],l=Object(r.useCallback)((function(e){if((c.current.get(e.userId)||0)<e.chatSeq)if(c.current.set(e.userId,e.chatSeq),e.chatInReplyTo){var t=e.chatText,n=e.chatInReplyTo;s((function(e){return e.map((function(e){if(e.replyTo.userId===n.userId&&e.replyTo.chatSeq===n.chatSeq){var r=new Map(e.replies);r.set(t,(r.get(t)||0)+1);var a=Object(y.a)(r.entries());return a.sort(H),Object(T.a)({},e,{replies:a})}return e}))}))}else{var r={key:"".concat(e.userId,"_").concat(e.chatSeq),replyTo:{userId:e.userId,chatSeq:e.chatSeq},nickname:e.nickname,text:e.chatText,replies:[]};s((function(e){return[r].concat(Object(y.a)(e)).slice(0,100)}))}}),[]),f=M(e,t),m=A(e,t,B);return Object(r.useEffect)((function(){m&&l(m.data)})),{chatList:u,sendChat:Object(r.useCallback)((function(e){var r={userId:t,nickname:n,chatSeq:a.current,chatText:e};a.current+=1,f(r),l(r)}),[f,t,n,l]),replyChat:Object(r.useCallback)((function(e,r){var c={userId:t,nickname:n,chatSeq:a.current,chatText:e,chatInReplyTo:r};a.current+=1,f(c),l(c)}),[f,t,n,l])}}(e.roomId,e.userId,e.nickname),n=t.chatList,c=t.sendChat,o=t.replyChat,i=Object(r.useState)(""),u=Object(d.a)(i,2),s=u[0],l=u[1];return a.a.createElement("div",{className:"MomentaryChat-container"},a.a.createElement("form",{onSubmit:function(e){e.preventDefault(),s&&(c(s),l(""))}},a.a.createElement("input",{value:s,onChange:function(e){return l(e.target.value)},placeholder:"Enter chat message"}),a.a.createElement("button",{type:"submit",disabled:!s},"Send")),a.a.createElement(K,{chatList:n,replyChat:o}))})),J=function(e){try{return window.localStorage.getItem(e)||""}catch(t){return""}}("nickname"),Q=function(e){var t=e.roomId,n=e.userId,c=Object(r.useState)(J),o=Object(d.a)(c,2),i=o[0],u=o[1],s=Object(r.useState)(""),l=Object(d.a)(s,2),f=l[0],m=l[1];Object(r.useEffect)((function(){!function(e){var t=window.location.hash.slice(1),n=new URLSearchParams(t);n.set("roomId",e),window.location.hash=n.toString()}(t)}),[t]);var b=function(){var e=Object(r.useState)([]),t=Object(d.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){Object(p.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N();case 2:t=e.sent,a(t);case 4:case"end":return e.stop()}}),e)})))()}),[]),n}(),h=function(){var e=Object(r.useState)([]),t=Object(d.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){Object(p.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L();case 2:t=e.sent,a(t);case 4:case"end":return e.stop()}}),e)})))()}),[]),n}(),g=Object(r.useState)(),y=Object(d.a)(g,2),E=y[0],k=y[1],I=Object(r.useState)(),O=Object(d.a)(I,2),w=O[0],j=O[1],C=Object(r.useState)("off"),S=Object(d.a)(C,2),M=S[0],A=S[1],T=Object(r.useState)(!0),D=Object(d.a)(T,2),R=D[0],P=D[1],U=function(e,t){var n=Object(r.useState)(),a=Object(d.a)(n,2),c=a[0],o=a[1];if(c&&"UNKNOWN_ERROR"===c.type)throw new Error("Network Error");return Object(r.useEffect)((function(){return x(e,t,o).unregister}),[e,t]),c}(t,n),V="remote-faces://".concat(window.location.href.replace(/^https:\/\//,""));return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"SingleRoom-status"},JSON.stringify(U)),a.a.createElement("div",{className:"SingleRoom-room-info"},R?a.a.createElement(a.a.Fragment,null,a.a.createElement("button",{type:"button",onClick:function(){return P(!1)}},"Hide config"),a.a.createElement("div",null,"Link to this room:",a.a.createElement("input",{value:window.location.href,readOnly:!0}),"(Share this link with your colleagues)",a.a.createElement("a",{href:V},"Open App")),a.a.createElement("div",{className:"SingleRoom-nickname"},"Your Name:"," ",a.a.createElement("input",{defaultValue:J,onChange:function(e){u(e.target.value),function(t,n){try{window.localStorage.setItem(t,n)}catch(e){console.log("Failed to save string to localStorage",e)}}("nickname",e.target.value)}})),a.a.createElement("div",{className:"SingleRoom-statusmesg"},"Your Status:"," ",a.a.createElement("input",{onChange:function(e){m(e.target.value)},placeholder:"Enter status message"})),a.a.createElement("div",null,"Select Camera:"," ",a.a.createElement("select",{onChange:function(e){return k(e.target.value)}},b.map((function(e){return a.a.createElement("option",{key:e.deviceId,value:e.deviceId},e.label)})))),a.a.createElement("div",null,"Select Mic:"," ",a.a.createElement("select",{onChange:function(e){return j(e.target.value)}},h.map((function(e){return a.a.createElement("option",{key:e.deviceId,value:e.deviceId},e.label)})))),a.a.createElement("div",null,"Live Type:"," ",a.a.createElement("select",{onChange:function(e){return A(e.target.value)}},a.a.createElement("option",{value:"off"},"Off"),a.a.createElement("option",{value:"video"},"Video Only"),a.a.createElement("option",{value:"video+audio"},"Video and Audio")))):a.a.createElement("button",{type:"button",onClick:function(){return P(!0)}},"Show config")),a.a.createElement(q,{roomId:t,userId:n,videoDeviceId:E,audioDeviceId:w,nickname:i,statusMesg:f,liveType:M}),a.a.createElement(Y,{roomId:t,userId:n,nickname:i}))},Z=function(){var e=window.location.hash.slice(1);return new URLSearchParams(e).get("roomId")}(),$=b(),X=function(){var e=Object(r.useState)(Z),t=Object(d.a)(e,2),n=t[0],c=t[1],o=Object(r.useState)(""),i=Object(d.a)(o,2),u=i[0],s=i[1];return n?a.a.createElement(Q,{roomId:n,userId:$}):a.a.createElement("div",{className:"SingleRoomEntrance-init"},a.a.createElement("button",{type:"button",onClick:function(){c(b())}},"Create a new room"),"OR",a.a.createElement("input",{value:u,onChange:function(e){return s(e.target.value)},placeholder:"Enter room link..."}),a.a.createElement("button",{type:"button",onClick:function(){c(g(u))},disabled:!g(u)},"Enter room"))},ee=(n(27),function(e){Object(l.a)(n,e);var t=Object(s.a)(n);function n(){var e;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).state={hasError:!1},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props.children;return this.state.hasError?a.a.createElement(f,null):e}}],[{key:"getDerivedStateFromError",value:function(){return{hasError:!0}}}]),n}(a.a.Component)),te=function(){return a.a.createElement("div",{className:"App"},a.a.createElement(ee,null,a.a.createElement(X,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(te,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[15,1,2]]]);
//# sourceMappingURL=main.0aaa9144.chunk.js.map